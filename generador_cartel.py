import streamlit as st
from docx import Document
from docx.shared import Pt
from docx.enum.text import WD_PARAGRAPH_ALIGNMENT
from datetime import datetime

def obtener_dia_semana(fecha, idiomas):
    dias = {
        "Espa√±ol": ["Lunes", "Martes", "Mi√©rcoles", "Jueves", "Viernes", "S√°bado", "Domingo"],
        "Portugu√©s": ["Segunda-Feira", "Ter√ßa-Feira", "Quarta-Feira", "Quinta-Feira", "Sexta-Feira", "S√°bado", "Domingo"],
        "Ingl√©s": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]
    }
    try:
        fecha_dt = datetime.strptime(fecha, "%d/%m/%Y")
        dias_traducidos = [dias.get(idioma, dias["Espa√±ol"])[fecha_dt.weekday()] for idioma in idiomas]
        return f"{' / '.join(dias_traducidos)} - {fecha}"
    except ValueError:
        return "D√≠a inv√°lido"

def generar_cartel(ciudad, fecha, actividad, hora_encuentro, punto_encuentro, desayuno, nombre_guia, op1, precio_op1, op2, precio_op2, idiomas):
    doc_path = "EJEMPLO CARTEL EMV.docx"
    doc = Document(doc_path)
    
    fecha_formateada = obtener_dia_semana(fecha, idiomas)
    
    traducciones = {
        "Espa√±ol": {"Bienvenidos": "¬°Bienvenidos!", "Gu√≠a": "GU√çA", "Opcional": "Paseo opcional", "NoOpcionales": "No hay Excursiones Opcionales para el D√≠a de Hoy", "Actividad": "Actividad", "Desayuno": "Desayuno"},
        "Portugu√©s": {"Bienvenidos": "Bem-Vindos!", "Gu√≠a": "GUIA", "Opcional": "Passeio opcional", "NoOpcionales": "N√£o h√° passeios opcionais para hoje", "Actividad": "Atividade", "Desayuno": "Caf√© da Manh√£"},
        "Ingl√©s": {"Bienvenidos": "Welcome!", "Gu√≠a": "GUIDE", "Opcional": "Optional excursion", "NoOpcionales": "There are no optional excursions for today", "Actividad": "Activity", "Desayuno": "Breakfast"}
    }
    
    textos_traducidos = [traducciones.get(idioma, traducciones["Espa√±ol"]) for idioma in idiomas]
    
    bienvenida = " / ".join([texto['Bienvenidos'] for texto in textos_traducidos])
    guia_traducido = " / ".join([texto['Gu√≠a'] for texto in textos_traducidos])
    actividad_traducida = " / ".join([texto['Actividad'] for texto in textos_traducidos]) + f" - {actividad}"
    desayuno_traducido = " / ".join([texto['Desayuno'] for texto in textos_traducidos]) + f": {desayuno}"
    
    opcionales_texto = "‚ú® Paseo opcional / Passeio opcional / Optional excursion"
    if not op1 and not op2:
        opcionales_texto += f"\n{' / '.join([texto['NoOpcionales'] for texto in textos_traducidos])}"
    else:
        if op1:
            opcionales_texto += f"\n{op1}\nüí∞ {precio_op1}"
        if op2:
            opcionales_texto += f"\n{op2}\nüí∞ {precio_op2}"
    
    reemplazos = {
        "(BIENVENIDA)": bienvenida,
        "(CIUDAD)": f"{ciudad}",
        "üìÖ": f"üìÖ {fecha_formateada}\n‚û°Ô∏è {desayuno_traducido}\n{actividad_traducida}",
        "‚è∞": f"‚è∞ {hora_encuentro}",
        "üìç": f"üìç {punto_encuentro}",
        "üßë‚Äçüíº": f"üßë‚Äçüíº {guia_traducido}: {nombre_guia}",
        "‚ú® Paseo opcional / Passeio opcional / Optional excursion": opcionales_texto
    }
    
    for p in doc.paragraphs:
        for key, value in reemplazos.items():
            if key in p.text:
                p.text = p.text.replace(key, value)
                for run in p.runs:
                    if key in ["(BIENVENIDA)", "(CIUDAD)"]:
                        run.font.name = "Neulis Sans Black"
                        run.font.size = Pt(18)
                        p.alignment = WD_PARAGRAPH_ALIGNMENT.CENTER
                    elif key == "üìÖ":
                        run.font.name = "Neulis Sans Black"
                        run.font.size = Pt(14)
                        p.alignment = WD_PARAGRAPH_ALIGNMENT.LEFT
                    else:
                        run.font.name = "Neulis Sans"
                        run.font.size = Pt(14)
                        p.alignment = WD_PARAGRAPH_ALIGNMENT.LEFT
    
    output_path = f"Cartel_{ciudad}_{'_'.join(idiomas)}.docx"
    doc.save(output_path)
    return output_path

st.title("Generador de Carteles para Pasajeros")
